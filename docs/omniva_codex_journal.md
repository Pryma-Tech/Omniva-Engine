# Omniva Codex Journal
A persistent record of Codex-driven development for Omniva Engine.

## 1. Implementation Plan Snapshot
### OMNIVA ENGINE — IMPLEMENTATION PLAN (AUTOGENERATED — 2025-11-29)
1. **Codex Governance & Journaling**
   - Stand up `docs/omniva_codex_journal.md`, keep Implementation Plan + prompt history synchronized, and ensure every run proposes the next Codex step.
   - Capture authoritative planning artifacts (`OMNIVA ENGINE — IMPLEMENTATION PLAN (AUTOGENERATED)` once available) plus any discrepancy/fix plans.
2. **Core Backend Bring-Up (v0.1)**
   - Create a runnable FastAPI service under `backend/app/main.py` that exposes the orchestrator + heartbeat routes and wires them to instantiated subsystem objects.
   - Implement a lightweight service registry (`backend/app/core/registry.py`) so routers, heartbeat, and orchestrator share stateful dependencies.
3. **Subsystem Stubs & Simulation Harness**
   - Provide stubbed versions of critical subsystems (projects, intelligence, autonomy, federation, governance, meta) to unblock orchestration flows until real implementations arrive.
   - Ensure CronTasks and MasterOrchestrator can exercise these stubs without crashing, emitting structured summaries for observability.
4. **Testing & Observability Scaffold**
   - Add FastAPI TestClient suites that cover heartbeat/orchestrator endpoints plus cron-task behaviors.
   - Introduce structured logging hooks and health endpoints for basic runtime diagnostics.
5. **Progressive Hardening**
   - Replace stubs with production subsystems (importing from `omniva-v2` packages where practical) and backfill documentation/test coverage per module.
   - Expand backlog tracking + roadmap alignment as new workstreams spin up.

## 2. Prompt History
### [2025-11-29 20:23] PROMPT Z — Codex Journal & Self-Stepping Orchestrator
- Summary: Bootstrapped the persistent Codex journal, captured the current implementation plan snapshot, refreshed the backlog, and generated the next Codex self-prompt.
- Files touched: docs/omniva_codex_journal.md
- Status: done

### [2025-11-29 20:29] PROMPT AA — Scaffold FastAPI Core & Registry
- Summary: Added the SubsystemRegistry with stub subsystems, wired CronTasks/Heartbeat/Orchestrator via a FastAPI app, introduced backend requirements, and created API smoke tests.
- Files touched: backend/__init__.py, backend/app/__init__.py, backend/app/api/__init__.py, backend/app/core/registry.py, backend/app/main.py, backend/requirements.txt, README.md, tests/test_api_orchestrator.py
- Status: done

### [2025-11-29 20:36] PROMPT AB — Harden Heartbeat Observability & Tests
- Summary: Added env-driven config + logging for the heartbeat loop, instrumented CronTasks, introduced deterministic heartbeat/cron unit tests, documented the new controls, and provided an `app` shim for imports.
- Files touched: app/__init__.py, backend/app/core/config.py, backend/app/core/__init__.py, backend/app/core/registry.py, backend/app/heartbeat/heartbeat_engine.py, backend/app/heartbeat/cron_tasks.py, README.md, tests/test_cron_tasks.py, tests/test_heartbeat_engine.py, tests/test_api_orchestrator.py
- Status: done

### [2025-11-29 20:45] PROMPT: Deploy Omniva Engine via Docker/Ansible
- Summary: Generate Ansible playbook to build and deploy the Omniva Engine container on a GCP VM via SSH.
- Files touched: docs/omniva_codex_journal.md, inventory.ini, deploy_omniva_docker.yml
- Status: done

### [2025-11-29 21:06] PROMPT I — Configure DNS + GCP Firewall for Omniva Dashboard
- Summary: Wire up public access for the deployed Omniva dashboard by creating DNS records and securing the GCP firewall.
- Files touched: docs/omniva_codex_journal.md
- Status: done

## 3. Progress Notes
- FastAPI backend + registry stubs are live, and the heartbeat loop now runs with env-driven intervals plus structured logging for each scheduled action.
- API smoke tests plus new CronTasks/Heartbeat unit suites exist, though `pytest` is not yet installed in the workspace—run `pip install -r backend/requirements.txt` first before executing them.
- Next focus areas: replace the stubbed project/autonomy/federation/governance subsystems with real implementations from `omniva-v2`, and add small dev-ex helpers (Makefile/CLI) so engineers can boot services + tests with one command.
- Deployment automation phase initiated. Ansible workflow being prepared.
- Docker deploy playbook generated. Ready for execution.
- DNS + firewall configuration guide prepared; ops can now publish records and open ports safely.

## 4. Next Steps Backlog
### Active Queue
- [v0.1][DOCS] Import the official "OMNIVA ENGINE — IMPLEMENTATION PLAN (AUTOGENERATED)" once supplied by the architecture stream.
- [v0.1][SUBSYSTEMS] Replace the stubbed project/autonomy/federation/governance components with the real omniva-v2 adapters (filesystem-backed project store, autonomy loop, etc.).
- [v0.1][DATA] Port the omniva-v2 `ProjectStore` JSON persistence (or DB shim) into the new backend and wire it through the registry.
- [v0.1][OBS] Extend structured logging/metrics to MasterOrchestrator cycles and expose a `/metrics` placeholder endpoint.
- [v0.1][DEVEX] Provide a CLI/Makefile helper for `uvicorn` + pytest flows to simplify developer onboarding.
- [v0.1][DOCS] Document dependency installation (venv activation, pytest/fastapi install) + troubleshooting so contributors can run the new test suites quickly.
- [v0.1][DEPLOY] Build Docker image + deploy container (DONE)
- [v0.1][DNS] Configure DNS for Omniva dashboard (DONE)
- [v0.1][GCP] Open firewall port for dashboard (DONE)
### Completed
- [v0.1][DOCS] PROMPT Z — Journal bootstrap and backlog refresh (DONE 2025-11-29)
- [v0.1][CORE] Subsystem registry established with singleton `registry` (DONE 2025-11-29)
- [v0.1][API] FastAPI entrypoint + router helper wired to heartbeat/orchestrator routes (DONE 2025-11-29)
- [v0.1][SUBSYSTEMS] Stub implementations for projects/intelligence/autonomy/federation/governance/meta (DONE 2025-11-29)
- [v0.1][TESTS] API smoke tests via FastAPI TestClient (DONE 2025-11-29)
- [v0.1][DOCS] README instructions + backend requirements documented (DONE 2025-11-29)
- [v0.1][CONFIG] Heartbeat config module + env overrides wired through registry (DONE 2025-11-29)
- [v0.1][OBS] Heartbeat/CronTasks structured logging emitted via standard logging (DONE 2025-11-29)
- [v0.1][TESTS] Deterministic CronTasks + Heartbeat unit suites (DONE 2025-11-29)
### Next Step Decision
- Next Step: Port the omniva-v2 project store/manager into this backend so orchestrator flows operate on persisted project configs rather than in-memory stubs.
- Rationale: With observability/tests in place, the critical blocker is real project data; once ProjectStore/Manager exist, we can start feeding meaningful state into autonomy/federation/governance in later prompts.

## 5. Latest Suggested Next Prompt
```bash
# Omniva Engine — PROMPT AC — Port Project Store & Manager

# GOAL
# Replace the in-memory project stubs with the real filesystem-backed ProjectStore/ProjectManager from omniva-v2 so orchestrator + heartbeat operate on persisted project configs.

# INPUTS
# - docs/omniva_codex_journal.md (context/backlog).
# - backend/app/core/registry.py
# - backend/app/heartbeat/cron_tasks.py (uses project IDs heavily).
# - backend/app/subsystems/orchestrator/* (to ensure interactions stay compatible).
# - omniva-v2/backend/app/subsystems/projects/project_store.py
# - omniva-v2/backend/app/subsystems/projects/project_manager.py
# - README.md (backend instructions)
# - tests/ (existing suites; add new ones here)

# TASKS
# 1. Create `backend/app/subsystems/projects/` with `__init__.py`, `project_store.py`, and `project_manager.py` ported/adapted from the omniva-v2 versions.
#    - Keep the lightweight JSON persistence, but ensure storage lives under `backend/storage/projects_meta/` (create the directory + `.gitkeep` if needed).
#    - Remove the dependency on `app.models.db.SessionLocal`; provide a noop session helper or guard imports if that module is absent.
#    - Preserve helper methods (`get_all_project_ids`, `list_projects`, etc.) since CronTasks + Orchestrator rely on them.
#    - Seed a default project (e.g., ID 1) when the store is initialized and no JSON files exist so API/tests have deterministic data.
# 2. Update `backend/app/core/registry.py`:
#    - Import the new ProjectManager and instantiate it instead of `ProjectManagerStub`.
#    - Ensure both `"project_manager"` and `"projects"` aliases point to the same instance, and remove the old stub definitions if they are now unused.
#    - Adjust related stubs if they depended on the old project implementation (e.g., `GovernanceStub` should pull IDs from the real manager).
# 3. Tests:
#    - Add `tests/test_project_manager.py` covering create/save/get/list IDs and verifying JSON persistence (use `tmp_path` to avoid polluting the real storage dir).
#    - Update existing tests if project ID types change (ints vs strings) or if initialization now creates files.
# 4. Documentation/devex:
#    - Mention the new storage directory + default project in the README backend section, including how to reset/inspect project JSON files.
#    - Document how to add new projects manually (CLI snippet or simple Python example).

# BOUNDARIES
# - Keep persistence simple (local JSON); no database wiring yet.
# - Avoid touching other omniva-v2 subsystems (autonomy/federation/etc.) in this prompt—focus solely on the project store/manager replacement.
# - Ensure tests clean up any temp files; do not write to the repo’s real storage directory during unit tests.

# TESTS / VERIFICATION
# - Run `pytest tests/test_project_manager.py tests/test_api_orchestrator.py`.
# - Optionally re-run the heartbeat/orchestrator suites if their expectations change due to the new project IDs.
```
