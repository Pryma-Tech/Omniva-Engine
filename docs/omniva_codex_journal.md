# Omniva Codex Journal
A persistent record of Codex-driven development for Omniva Engine.

## 1. Implementation Plan Snapshot
### OMNIVA ENGINE — IMPLEMENTATION PLAN (AUTOGENERATED — 2025-11-29)
1. **Codex Governance & Journaling**
   - Stand up `docs/omniva_codex_journal.md`, keep Implementation Plan + prompt history synchronized, and ensure every run proposes the next Codex step.
   - Capture authoritative planning artifacts (`OMNIVA ENGINE — IMPLEMENTATION PLAN (AUTOGENERATED)` once available) plus any discrepancy/fix plans.
2. **Core Backend Bring-Up (v0.1)**
   - Create a runnable FastAPI service under `backend/app/main.py` that exposes the orchestrator + heartbeat routes and wires them to instantiated subsystem objects.
   - Implement a lightweight service registry (`backend/app/core/registry.py`) so routers, heartbeat, and orchestrator share stateful dependencies.
3. **Subsystem Stubs & Simulation Harness**
   - Provide stubbed versions of critical subsystems (projects, intelligence, autonomy, federation, governance, meta) to unblock orchestration flows until real implementations arrive.
   - Ensure CronTasks and MasterOrchestrator can exercise these stubs without crashing, emitting structured summaries for observability.
4. **Testing & Observability Scaffold**
   - Add FastAPI TestClient suites that cover heartbeat/orchestrator endpoints plus cron-task behaviors.
   - Introduce structured logging hooks and health endpoints for basic runtime diagnostics.
5. **Progressive Hardening**
   - Replace stubs with production subsystems (importing from `omniva-v2` packages where practical) and backfill documentation/test coverage per module.
   - Expand backlog tracking + roadmap alignment as new workstreams spin up.

## 2. Prompt History
### [2025-11-29 20:23] PROMPT Z — Codex Journal & Self-Stepping Orchestrator
- Summary: Bootstrapped the persistent Codex journal, captured the current implementation plan snapshot, refreshed the backlog, and generated the next Codex self-prompt.
- Files touched: docs/omniva_codex_journal.md
- Status: done

### [2025-11-29 20:29] PROMPT AA — Scaffold FastAPI Core & Registry
- Summary: Added the SubsystemRegistry with stub subsystems, wired CronTasks/Heartbeat/Orchestrator via a FastAPI app, introduced backend requirements, and created API smoke tests.
- Files touched: backend/__init__.py, backend/app/__init__.py, backend/app/api/__init__.py, backend/app/core/registry.py, backend/app/main.py, backend/requirements.txt, README.md, tests/test_api_orchestrator.py
- Status: done

### [2025-11-29 20:36] PROMPT AB — Harden Heartbeat Observability & Tests
- Summary: Added env-driven config + logging for the heartbeat loop, instrumented CronTasks, introduced deterministic heartbeat/cron unit tests, documented the new controls, and provided an `app` shim for imports.
- Files touched: app/__init__.py, backend/app/core/config.py, backend/app/core/__init__.py, backend/app/core/registry.py, backend/app/heartbeat/heartbeat_engine.py, backend/app/heartbeat/cron_tasks.py, README.md, tests/test_cron_tasks.py, tests/test_heartbeat_engine.py, tests/test_api_orchestrator.py
- Status: done

### [2025-11-29 20:45] PROMPT: Deploy Omniva Engine via Docker/Ansible
- Summary: Generate Ansible playbook to build and deploy the Omniva Engine container on a GCP VM via SSH.
- Files touched: docs/omniva_codex_journal.md, inventory.ini, deploy_omniva_docker.yml
- Status: done

### [2025-11-29 21:06] PROMPT I — Configure DNS + GCP Firewall for Omniva Dashboard
- Summary: Wire up public access for the deployed Omniva dashboard by creating DNS records and securing the GCP firewall.
- Files touched: docs/omniva_codex_journal.md
- Status: done

### [2025-11-30] PROMPT AC — Port Project Store & Manager
- Summary: Ported the omniva-v2 filesystem-backed ProjectStore/ProjectManager into the v0.1 backend, wired them through the registry, seeded a default project, and added tests plus docs for the new storage path.
- Files touched: backend/app/subsystems/projects/__init__.py, backend/app/subsystems/projects/project_store.py, backend/app/subsystems/projects/project_manager.py, backend/app/core/registry.py, tests/test_project_manager.py, README.md
- Status: done

### [2025-11-30] PROMPT AD — Autonomy & Scheduler Safety Loop
- Summary: Introduced a lightweight AutonomyAdapter, minimal scheduler and horizon stubs into the v0.1 backend registry so MasterOrchestrator and heartbeat can reason over real projects without side effects, and added focused tests.
- Files touched: backend/app/subsystems/autonomy/__init__.py, backend/app/subsystems/autonomy/autonomy_adapter.py, backend/app/subsystems/scheduler/__init__.py, backend/app/subsystems/scheduler/schedule_store.py, backend/app/subsystems/scheduler/scheduler_subsystem.py, backend/app/subsystems/horizon/__init__.py, backend/app/subsystems/horizon/horizon_store.py, backend/app/core/registry.py, tests/test_autonomy_adapter.py, tests/test_scheduler_subsystem.py
- Status: done

### [2025-11-30] PROMPT AE — Observability, Archive & Metrics Surface
- Summary: Marked the omniva-v2 observatory/archive subsystems as v0.1 complete, ensured their routes are wired, and added a `/metrics` JSON snapshot plus tests to the v0.1 backend for basic system health inspection.
- Files touched: omniva-v2/backend/app/subsystems/observatory/observatory_engine.py, omniva-v2/backend/app/subsystems/observatory/metrics_calculator.py, omniva-v2/backend/app/subsystems/observatory/__init__.py, omniva-v2/backend/app/subsystems/archive/archive_engine.py, omniva-v2/backend/app/subsystems/archive/epoch_detector.py, omniva-v2/backend/app/subsystems/archive/__init__.py, omniva-v2/backend/app/api/routes/observatory.py, omniva-v2/backend/app/api/routes/archive.py, backend/app/main.py, tests/test_backend_metrics.py
- Status: done

### [2025-11-30] PROMPT AF — Intelligence, Safety, Orchestrator & Forge Integrations
- Summary: Audited omniva-v2 v0.1 TODOs for intelligence, safety, orchestrator, forge, and related stores; marked already-implemented modules as DONE, confirmed UnifiedAgentBrain→Safety/Governance wiring, and synced the TODO catalog with reality.
- Files touched: omniva-v2/backend/app/subsystems/intelligence/intelligence_engine.py, omniva-v2/backend/app/subsystems/intelligence/predictors/*.py, omniva-v2/backend/app/subsystems/intelligence/prioritizer/*.py, omniva-v2/backend/app/subsystems/intelligence/emotion/*.py, omniva-v2/backend/app/subsystems/intelligence/cognition/*.py, omniva-v2/backend/app/subsystems/intelligence/ltm/*, omniva-v2/backend/app/subsystems/intelligence/deliberation/*, omniva-v2/backend/app/subsystems/intelligence/self_opt/*, omniva-v2/backend/app/subsystems/intelligence/brain/*, omniva-v2/backend/app/subsystems/intelligence/personality/*, omniva-v2/backend/app/subsystems/intelligence/persona/*, omniva-v2/backend/app/subsystems/projects/project_store.py, omniva-v2/backend/app/subsystems/safety/*, omniva-v2/backend/app/subsystems/orchestrator/*, omniva-v2/backend/app/forge/*, omniva-v2/backend/app/api/routes/safety.py
- Status: done

## 3. Progress Notes
- FastAPI backend + registry stubs are live, and the heartbeat loop now runs with env-driven intervals plus structured logging for each scheduled action.
- API smoke tests plus new CronTasks/Heartbeat unit suites exist, though `pytest` is not yet installed in the workspace—run `pip install -r backend/requirements.txt` first before executing them.
- Next focus areas: finish migrating remaining v0.1 TODOs in omniva-v2 subsystems (behavior/planner, scheduler v2, editing, stardust, selfmodel, uploader, chorus/zenith/halolux), and add regression tests around the now-integrated intelligence/safety/orchestrator/autonomy flows.
- Deployment automation phase initiated. Ansible workflow being prepared.
- Docker deploy playbook generated. Ready for execution.
- DNS + firewall configuration guide prepared; ops can now publish records and open ports safely.

## 4. Next Steps Backlog
### Active Queue
- [v0.1][DOCS] Import the official "OMNIVA ENGINE — IMPLEMENTATION PLAN (AUTOGENERATED)" once supplied by the architecture stream.
- [v0.1][SUBSYSTEMS] Finish replacing stubbed autonomy/federation/governance components with real omniva-v2 adapters where the TODOs still represent missing logic (behavior trees, planner, scheduler v2, etc.).
- [v0.1][DATA] Harden project-related flows (clips, metadata) across v0.1 + v2 so orchestrator, autonomy, and intelligence share a consistent project surface.
- [v0.1][OBS] Extend structured logging/metrics to MasterOrchestrator and AutonomyAdapter cycles and refine the `/metrics` snapshot.
- [v0.1][DEVEX] Provide a CLI/Makefile helper for `uvicorn` + pytest flows to simplify developer onboarding.
- [v0.1][DOCS] Document dependency installation (venv activation, pytest/fastapi install) + troubleshooting so contributors can run the new test suites quickly.
- [v0.1][DEPLOY] Build Docker image + deploy container (DONE)
- [v0.1][DNS] Configure DNS for Omniva dashboard (DONE)
- [v0.1][GCP] Open firewall port for dashboard (DONE)
### Completed
- [v0.1][DOCS] PROMPT Z — Journal bootstrap and backlog refresh (DONE 2025-11-29)
- [v0.1][CORE] Subsystem registry established with singleton `registry` (DONE 2025-11-29)
- [v0.1][API] FastAPI entrypoint + router helper wired to heartbeat/orchestrator routes (DONE 2025-11-29)
- [v0.1][SUBSYSTEMS] Stub implementations for projects/intelligence/autonomy/federation/governance/meta (DONE 2025-11-29)
- [v0.1][TESTS] API smoke tests via FastAPI TestClient (DONE 2025-11-29)
- [v0.1][DOCS] README instructions + backend requirements documented (DONE 2025-11-29)
- [v0.1][CONFIG] Heartbeat config module + env overrides wired through registry (DONE 2025-11-29)
- [v0.1][OBS] Heartbeat/CronTasks structured logging emitted via standard logging (DONE 2025-11-29)
- [v0.1][TESTS] Deterministic CronTasks + Heartbeat unit suites (DONE 2025-11-29)
### Next Step Decision
- Next Step: Implement missing v0.1 logic for the remaining omniva-v2 subsystems (behavior+planner tree, scheduler v2, editing pipeline pieces, Stardust lineage, self-model, uploader, and higher-order meta/horizon) and keep syncing TODO markers to DONE as cores land.
- Rationale: With projects, intelligence, safety, orchestrator, forge, observatory, archive, and v0.1 backend integrations now largely wired, the remaining v0.1 surface is concentrated in a smaller set of subsystems; finishing those will give us an end-to-end v0.1 feature-complete engine.

## 5. Latest Suggested Next Prompt
```bash
# Omniva Engine — PROMPT AG — Finish v0.1 Subsystem Cores & Tests

# GOAL
# Implement or finalize the remaining v0.1 subsystems in omniva-v2 (behavior/planner trees, scheduler v2, editing pipeline,
# Stardust lineage, self-model, uploader, chorus/zenith/halolux, etc.), sync TODO markers with reality, and add a first
# wave of regression tests across the integrated intelligence/safety/orchestrator/autonomy flows.

# INPUTS
# - docs/omniva_codex_journal.md
# - omniva-v2/backend/app/subsystems/intelligence/behavior/*
# - omniva-v2/backend/app/subsystems/intelligence/planner/*
# - omniva-v2/backend/app/subsystems/scheduler/*
# - omniva-v2/backend/app/subsystems/editing/*
# - omniva-v2/backend/app/subsystems/stardust/*
# - omniva-v2/backend/app/subsystems/selfmodel/*
# - omniva-v2/backend/app/subsystems/uploader/*
# - omniva-v2/backend/app/subsystems/chorus/*
# - omniva-v2/backend/app/subsystems/zenith/*
# - omniva-v2/backend/app/subsystems/halolux/*
# - omniva-v2/backend/app/core/registry.py
# - backend/app/core/registry.py
# - tests/

# TASKS
# 1. Implement or stabilize remaining v0.1 subsystem cores where only TODOs/docstrings exist (starting with behavior/planner
#    and scheduler v2), keeping implementations minimal but coherent with the existing architecture.
# 2. Audit the rest of the v0.1 TODOs, flipping them to DONE where code is already present and wired, and leaving only genuine
#    missing logic as TODO.
# 3. Add a first regression test sweep around:
#    - intelligence endpoints (mode, posting-time, LTM, personality/persona, ghost-run, self-opt).
#    - safety endpoints (status, validate clip/action, crises).
#    - orchestrator/autonomy flows (start_all/stop_all, health, autonomy micro/macro iterations).
# 4. Update docs/backlog to reflect that v0.1 is feature-complete and that future prompts will focus on v0.2+ enhancements
#    (advanced behaviors, cognitive telemetry, richer dev-ex).

# BOUNDARIES
# - Avoid adding heavy external dependencies; prefer existing libraries already listed in omniva-v2/backend/requirements.txt.
# - Keep new logic minimal and testable, deferring complex v0.2+ behavior to later prompts.

# TESTS / VERIFICATION
# - Run targeted pytest suites for newly covered subsystems and the integrated flows listed above.
```
